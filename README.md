# 智能投研平台需求分析（React + TS + shadcn / NestJS）

## 1. 一句话结论
这是一个“**多市场（A/H/US）+ 多资产（股票/基金/贵金属）+ 多智能体协作分析 + 自动化投研工作流**”的平台，核心壁垒在于：
1) 数据质量与时效；
2) 可解释的 AI 决策链路；
3) 策略执行与风控闭环。

---

## 2. 需求拆解（按业务域）

### 2.1 AI 决策仪表盘（最高优先级）
输出必须标准化：
- 一句话核心结论（看多/中性/看空 + 置信度）
- 精确买卖点位（入场、止损、止盈、仓位建议）
- 操作检查清单（是否满足交易纪律）

建议增加：
- 决策解释卡片（触发依据：技术面、资金面、情绪面）
- “反例风险”提示（哪些条件会让结论失效）

### 2.2 多维度分析引擎
- 技术面：K线形态、趋势、量价、关键均线、波动率
- 筹码分布：成本区、密集区、套牢区（A 股需特殊适配）
- 舆情情报：新闻、公告、社媒情绪、热词演化
- 实时行情：盘口、逐笔/分时（取决于行情供应商）

### 2.3 全球市场支持
- A 股：交易日历、涨跌停、北向资金、行业板块体系
- 港股：交易时段与美股重叠影响
- 美股：盘前盘后、财报事件驱动

### 2.4 复盘与组合管理
- 大盘复盘：指数、行业、资金流、核心事件
- 多组合：账户维度、策略维度、风险维度
- 收益分析：绝对收益、超额收益、回撤、夏普
- 压力测试：黑天鹅情景（利率、汇率、商品冲击）
- AI 诊断：组合偏离目标风险的原因定位

### 2.5 基金与股票监控
- 基金池管理：主题、风格、经理、回撤阈值
- 自动报告：盘前策略 + 盘后归因
- 自选股监控：基本面 + 技术面 + 风险事件雷达

### 2.6 AI 推荐与资讯能力
- 智能选股/选基：量化因子打分 + LLM 解释
- 新闻聚合：多源去重、可信度评分、情绪强度
- 商品情报：黄金/白银与美元、利率、地缘事件联动
- 市场情绪：多指标综合（波动率、成交、涨跌分布）

### 2.7 平台能力
- 邮件通知：日报、异动、风控触发推送
- 定时任务：盘前/盘中/盘后自动调度
- 多 LLM：OpenAI / Gemini / 兼容接口（统一网关）

---

## 3. 推荐技术架构

## 3.1 前端（React + TypeScript + shadcn/ui）
- 框架建议：Next.js（App Router）
- 状态管理：Zustand + React Query
- 图表：ECharts（金融图表能力完整）
- 权限：仅管理员创建用户（暂不做复杂权限系统）

核心页面：
1. AI 决策仪表盘
2. 市场总览（A/H/US）
3. 自选股与预警中心
4. 基金池与组合分析
5. 新闻与情绪中心
6. 策略任务中心（定时任务、邮件模板）

## 3.2 后端（NestJS）
按领域拆分模块（建议 Monorepo）：
- market-data（行情接入、标准化、缓存）
- analytics（技术指标、因子计算、归因）
- ai-orchestrator（多智能体编排）
- portfolio（组合、持仓、绩效）
- alerting（规则引擎、通知中心）
- reporting（盘前/盘后报告）
- auth/user（鉴权、用户管理）

异步链路：
- BullMQ + Redis 做任务队列
- Cron + 事件驱动（Kafka/NATS 二选一，可后期引入）

## 3.3 数据库选型（推荐）
主库建议：**PostgreSQL + TimescaleDB 扩展 + Redis**
- PostgreSQL：业务主数据（用户、组合、策略、配置）
- TimescaleDB：时序行情、指标快照、回测结果
- Redis：实时缓存、会话、队列、热点榜单

可选增强：
- OpenSearch：新闻全文检索与舆情聚合
- S3/OSS：报告、图表、审计文件归档

为什么不先上 ClickHouse：
- 你当前阶段更需要“业务一致性 + 中高频时序查询 + 快速迭代”
- Timescale 足够支撑 MVP 到中期；后续极大规模再引入 ClickHouse 做 OLAP 专仓

## 3.4 登录与用户管理（按你新需求补充）
目标：**仅管理员可创建用户，普通用户只能登录与使用平台功能**。

推荐实现（NestJS）：
- `auth` 模块：登录、刷新令牌、登出、密码更新
- `users` 模块：用户 CRUD（仅管理员可创建/禁用）
- 暂不单独建设 RBAC 模块：仅保留“是否管理员”的简单权限判断

建议最小 API：
1. `POST /auth/login`（用户名/邮箱 + 密码）
2. `POST /auth/refresh`（刷新 access token）
3. `POST /auth/logout`（可选：令牌拉黑）
4. `POST /admin/users`（**仅 admin**，创建用户）
5. `PATCH /admin/users/:id/status`（**仅 admin**，启用/禁用）
6. `GET /admin/users`（**仅 admin**，分页查看）

权限规则（MVP，简化版）：
- `is_admin = true`：创建用户、重置密码、禁用账户、查看用户列表
- `is_admin = false`：登录、修改自己的密码、查看和使用业务功能

登录安全建议：
- 密码哈希：`argon2`（优先）或 `bcrypt`
- 令牌：JWT（短期 access token + 中期 refresh token）
- 关键操作审计：记录管理员创建用户、重置密码、禁用账号
- 防爆破：登录限流（IP + 用户维度）

数据库最小表设计：
- `users`：`id`, `email`, `username`, `password_hash`, `status`, `last_login_at`, `created_at`
- `audit_logs`：`actor_user_id`, `action`, `target_type`, `target_id`, `payload`, `created_at`

初始化策略：
- 系统首次部署通过环境变量注入“超级管理员”账号；
- 之后所有新用户只能由管理员在后台创建（满足你“暂时只能管理员创建用户”的要求）。

---

## 4. 多智能体协作方案（核心）

建议 6 个 Agent：
1. **行情 Agent**：读取实时与历史行情，生成结构化特征
2. **技术面 Agent**：趋势/形态/指标打分
3. **基本面 Agent**：财务、估值、公告事件
4. **舆情 Agent**：新闻情绪、热度与可信度
5. **风控 Agent**：仓位、回撤、止损规则校验
6. **投委会 Agent（总控）**：汇总冲突观点，输出最终建议

编排机制：
- 统一输入 Schema（标的、周期、风险偏好）
- 每个 Agent 输出 `结论 + 证据 + 置信度 + 失效条件`
- 总控做“加权投票 + 风险约束”，给出可执行指令

---

## 5. MVP 建议（12 周）

### 阶段 1（第 1-4 周）
- 打通 A 股 + 美股基础行情
- 完成 AI 仪表盘 v1（结论/点位/清单）
- 自选股监控 + 邮件预警
- 完成管理员创建用户 + 用户登录（管理员开通账号）

### 阶段 2（第 5-8 周）
- 基金池管理 + 盘前/盘后报告自动化
- 多智能体 v1（技术面 + 舆情 + 风控）
- 组合绩效分析（收益、回撤、归因）

### 阶段 3（第 9-12 周）
- 港股接入、市场情绪与商品情报
- 多 LLM 网关
- 压力测试 + AI 诊断

---

## 6. 关键风险与对策
- **行情源合规与成本**：先做供应商抽象层，避免绑定单一厂商
- **AI 幻觉风险**：强制证据链 + 可追溯引用 + 风控 Agent 最终否决权
- **实时性能压力**：冷热分层（Redis 热数据 + Timescale 冷数据）
- **可解释性不足**：输出模板强制包含“依据/失效条件/风险等级”
- **账号安全风险**：MFA 预留、登录限流、审计日志、管理员操作二次确认

---

## 7. 我建议你马上确认的 8 个问题
1. 第一批上线市场是 A 股优先，还是 A + US 同步？
2. 行情供应商预算区间（决定实时粒度）？
3. 用户角色：个人投资者还是投顾团队？
4. 是否需要实盘下单，还是只做决策支持？
5. 可接受的信号延迟（秒级/分钟级）？
6. 报告频率（日报、周报、事件触发）？
7. 风控红线（最大回撤、单票仓位、行业暴露）？
8. 本地化部署/云部署及合规要求？

> 鉴于你新增了登录需求，建议再补 2 个：
9. 管理员创建用户时，是否需要“初始密码 + 首次登录强制改密”？
10. 是否后续需要接入企业 SSO（如钉钉/飞书/Google）？

---

## 8. 结论
你的需求是“高价值但复杂度高”的产品方向。建议以“**AI 决策仪表盘 + 自选监控 + 自动报告**”为 MVP 主线，先建立可解释、可执行、可复盘的闭环，再逐步扩展到多市场与多智能体深度协作。
